<!DOCTYPE html>

<html lang="zxx" class="js">

    <head>

        <base href="../../">

        <meta charset="utf-8">

        <meta name="author" content="Author Name">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <meta name="description" content="A powerful and conceptual apps base dashboard template that especially build for developers and programmers.">
        
        <!-- Fav Icon  -->
        <link rel="shortcut icon" href="./images/favicon.png">
        
        <!-- Page Title  -->
        <title>ID Generator</title>

        <link rel="stylesheet" href="./plugins/croppie/croppie.css">

        <style>

            /* .container {
                display: inline-flex;
                flex-wrap: wrap;
                justify-content:space-between;
                width:100%;
                border: 2px solid gray;
            } */

            /* .container {
                line-height: 0;
                
                -webkit-column-count: 3;
                -webkit-column-gap:   0px;
                -moz-column-count:    3;
                -moz-column-gap:      0px;
                column-count:         3;
                column-gap:           0px;
            }

            .container img {

                width: 100% !important;
                height: auto !important;
            } */

        </style>
        
    </head>

    <body>

        <input type="hidden" id="selected_img">

        <button type="button" onclick="selectPackage(1)">1</button>
        <button type="button" onclick="selectPackage(2)">2</button>
        <button type="button" onclick="selectPackage(3)">3</button>
        <button type="button" onclick="selectPackage(4)">4</button>
        <button type="button" onclick="selectPackage(5)">5</button>
        <button type="button" onclick="selectPackage(6)">6</button>

        <div class="form-group">
            <p><b>Image</b></p>
            <input type="file" id="upload"> 
            <div id="img_slots">
                <!-- <img class="my-image" src="demo/demo-1.jpg" id="item_img" />   -->
            </div>
        </div>

        <div id="preview_pane_div" style="display:none;">
            <h1>Result</h1>
            <div class="grid" id="image_results">
                <!-- <img id="img_preview_pane" src="" alt=""> -->
            </div>
        </div>

        <button type="button" onclick="nextBtn()">Next</button>

        <script src="./plugins/jquery.min.js"></script>

        <script src="./plugins/croppie/croppie.js"></script>
        <script src="./plugins/croppie/croppie.min.js"></script>

        <script src="./plugins/masonry.pkgd.min.js"></script>
        <script src="./plugins/masonry.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/masonry-layout/masonry.min.js"></script> -->

        <script>

            function selectPackage(pkg_no){

                $('#img_slots').html('')

                var package_val = pkg_no

                if(package_val == 1){

                    twoByTwo(1)
                    passportSize(1)
                    oneByOne(9)
                    
                    // 2x2          = 1
                    // Passport     = 1
                    // 1x1          = 9
                }

                else if(package_val == 2){

                    twoByTwo(1)
                    passportSize(1)
                    oneByOne(3)
                    oneByFive(2)

                    // 2x2          = 1
                    // Passport     = 1
                    // 1x1          = 3
                    // 1x5          = 2
                }

                else if(package_val == 3){

                    twoByTwo(2)
                    passportSize(2)
                    oneByOne(3)

                    // 2x2          = 2
                    // Passport     = 2
                    // 1x1          = 3
                }

                else if(package_val == 4){

                    oneByOne(9)
                    oneByFive(2)

                    // 1x1          = 9
                    // 1x5          = 2
                }

                else if(package_val == 5){

                    oneByOne(15)

                    // 1x1          = 15
                }

                else if(package_val == 6){

                    twoByTwo(2)
                    oneByOne(7)

                    // 1x1          = 7
                    // 2x2          = 2
                }
            }



            // ================ Image Sizes Functions ==================== 
                function oneByOne(image_count){

                    var output=''

                    var selected_img = $('#selected_img').val()

                    output+='<h1 style="text-align:center;">1x1</h1>'
                    output+='<img class="my-image" src="'+ selected_img +'" id="img_1x1" iteration="'+ image_count +'" />'

                    $(output).appendTo('#img_slots')

                    initializeCroppie('img_1x1', 94, 94)

                }


                function oneByFive(image_count){

                    var output=''

                    var selected_img = $('#selected_img').val()

                    output+='<h1 style="text-align:center;">1x5</h1>'
                    output+='<img class="my-image" src="'+ selected_img +'" id="img_1x5" iteration="'+ image_count +'" />'

                    $(output).appendTo('#img_slots')

                    initializeCroppie('img_1x5', 136, 144)

                }


                function twoByTwo(image_count){

                    var output=''

                    var selected_img = $('#selected_img').val()

                    output+='<h1 style="text-align:center;">2x2</h1>'
                    output+='<img class="my-image" src="'+ selected_img +'" id="img_2x2" iteration="'+ image_count +'" />'

                    $(output).appendTo('#img_slots')

                    initializeCroppie('img_2x2', 193, 193)

                }


                function passportSize(image_count){

                    var output=''   

                    var selected_img = $('#selected_img').val()

                    output+='<h1 style="text-align:center;">Passport Size</h1>'
                    output+='<img class="my-image" src="'+ selected_img +'" id="img_passport" iteration="'+ image_count +'" />'

                    $(output).appendTo('#img_slots')

                    initializeCroppie('img_passport', 132, 173)

                }
            // ================ Image Sizes Functions END ================



            function initializeCroppie(id, width, height){

                $uploadCrop = $('#'+id).croppie({
                    viewport: {
                        width: width,
                        height: height,
                        type: 'square'
                    },
                    enforceBoundary: false,
                    boundary: {
                        width: 300,
                        height: 300
                    }
                })

                return $uploadCrop

            }

            //Button (Displays the image)
            $('#upload').on('change', function () { 

                var reader = new FileReader();

                reader.onload = function (e) {

                    // $uploadCrop.croppie('bind', {

                        // alert(e.target.result)

                        $('#selected_img').val(e.target.result)

                    // }).then(function(){
                            
                        // alert(e.target.result)
                    // })

                }

                reader.readAsDataURL(this.files[0])
            })


            function nextBtn(){

                $('#image_results').html('')

                var output=''

                var croppie_divs = document.querySelectorAll('.my-image')

                $.each(croppie_divs, function(key, value){

                    var croppie_Id = $(this).attr('id')
                    var iteration  = $(this).attr('iteration')

                    $('#'+croppie_Id).croppie('result', {
                        type: 'canvas',
                        size: 'viewport'
                    }).then(function (resp) {

                        for(var i = 0; i < iteration; i++){

                            output+='<img class="item" id="preview_'+ croppie_Id +'" src="'+ resp +'" style="border: 1px solid gray;">'
                            
                        }
                        
                        // console.log('#preview_'+ croppie_Id + ' | '+ resp)

                    })
                    
                })

                $('#preview_pane_div').show()

                setTimeout(function(){
                    
                    $(output).appendTo('#image_results')

                }, 200)

                // setTimeout(function(){

                //     $('.grid').masonry({
                //         itemSelector: '.item',
                //         fitWidth:true,

                //     })

                // }, 2000)
                
            }

        </script>

    </body>

</html>